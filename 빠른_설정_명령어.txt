================================================================================
CodeLog - 빠른 설정 명령어 (EC2 Android 빌드 환경)
================================================================================

📅 작성일: 2025-10-15
🎯 목적: Gradle 에러 해결 & 실제 APK 빌드

================================================================================
1단계: 로컬에서 Push (Windows)
================================================================================

cd D:\CodeLog
git add .
git commit -m "Fix: Add Android build environment setup"
git push origin main


================================================================================
2단계: EC2 접속
================================================================================

ssh -i "D:\CodeLog\codelog-keypair.pem" ubuntu@YOUR_EC2_IP

⚠️ YOUR_EC2_IP를 실제 IP로 변경!


================================================================================
3단계: EC2에서 실행 (중요!)
================================================================================

# 최신 코드 가져오기
cd ~/CodeLog
git pull origin main

# 환경 설치 스크립트 실행 (10-15분 소요)
chmod +x setup-android-build-environment.sh
./setup-android-build-environment.sh

# 환경 변수 적용
source ~/.bashrc

# 확인
java --version
gradle --version
echo $ANDROID_HOME

# Docker 재빌드
docker compose down --rmi all
docker compose build --no-cache
docker compose up -d

# 로그 확인
docker compose logs -f backend


================================================================================
4단계: 테스트
================================================================================

1. 브라우저: http://YOUR_EC2_IP
2. 로그인 후 프로젝트 생성
3. 빌드 시작
4. 로그에서 확인:
   ✅ "Capacitor-based Android build"
   ❌ "Creating demo APK" (이 메시지가 없어야 함!)


================================================================================
예상 시간
================================================================================

- 환경 설치: 10-15분
- Docker 재빌드: 5-10분
- 첫 APK 빌드: 10-15분
- 이후 빌드: 3-5분


================================================================================
문제 해결
================================================================================

# 스크립트 권한 에러
chmod +x setup-android-build-environment.sh

# Docker 완전 재설정
docker compose down -v --rmi all
docker system prune -a -f
docker compose build --no-cache
docker compose up -d

# 환경 변수 확인
env | grep -E 'JAVA|ANDROID|GRADLE'

# 메모리 부족 (스왑 추가)
sudo fallocate -l 4G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile


================================================================================
전체 재설정 (한 번에 실행)
================================================================================

cd ~/CodeLog && \
git pull origin main && \
chmod +x setup-android-build-environment.sh && \
./setup-android-build-environment.sh && \
source ~/.bashrc && \
docker compose down --rmi all && \
docker compose build --no-cache && \
docker compose up -d && \
docker compose logs -f backend


================================================================================
성공 확인
================================================================================

✅ java --version → openjdk 17.x
✅ gradle --version → Gradle 8.x
✅ docker compose ps → 3 containers running
✅ 빌드 로그에 "Capacitor-based" 있음
✅ 빌드 로그에 "demo APK" 없음
✅ APK 다운로드 가능
✅ APK가 실제로 작동함


================================================================================
도움말
================================================================================

상세 가이드: EC2_빌드_환경_설정_완벽_가이드.md
설치 스크립트: setup-android-build-environment.sh
공식 가이드: Android_빌드_설정_가이드.txt


================================================================================
