================================================================================
CodeLog - ë¹ ë¥¸ ëª…ë ¹ì–´ ëª¨ìŒ (ì¹˜íŠ¸ì‹œíŠ¸)
================================================================================

ğŸ“‹ ë³µì‚¬í•´ì„œ ë°”ë¡œ ì‚¬ìš©í•˜ì„¸ìš”!
ğŸ’¡ YOUR_IP, YOUR_KEY ë“±ì€ ì‹¤ì œ ê°’ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”

================================================================================
ğŸ–¥ï¸ ë¡œì»¬ (Windows PowerShell)
================================================================================

# í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd D:\CodeLog

# Git ìƒíƒœ í™•ì¸
git status

# ë³€ê²½ì‚¬í•­ ì¶”ê°€
git add .

# ì»¤ë°‹
git commit -m "ìˆ˜ì •ì‚¬í•­ ì„¤ëª…"

# GitHub í‘¸ì‹œ
git push origin main

# í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ í…ŒìŠ¤íŠ¸
cd frontend
npm run build

# í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì„œë²„
npm run dev

# ë°±ì—”ë“œ ê°œë°œ ì„œë²„
cd ..\backend
npm run dev

================================================================================
ğŸ“¤ íŒŒì¼ ì „ì†¡ (ë¡œì»¬ â†’ ì„œë²„)
================================================================================

# í‚¤ íŒŒì¼ ìœ„ì¹˜ ë³€ìˆ˜ ì„¤ì • (í•œ ë²ˆë§Œ)
$KEY = "C:\keys\codelog-keypair.pem"
$IP = "YOUR_EC2_IP"

# ì „ì²´ í”„ë¡œì íŠ¸ ì „ì†¡
scp -i $KEY -r D:\CodeLog ubuntu@${IP}:~

# ë‹¨ì¼ íŒŒì¼ ì „ì†¡ (ì˜ˆ: ProjectDetail.jsx)
scp -i $KEY D:\CodeLog\frontend\src\pages\ProjectDetail.jsx ubuntu@${IP}:~/CodeLog/frontend/src/pages/

# ë°±ì—”ë“œ íŒŒì¼ ì „ì†¡
scp -i $KEY D:\CodeLog\backend\server.js ubuntu@${IP}:~/CodeLog/backend/

# í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ì „ì†¡ (ì£¼ì˜!)
scp -i $KEY D:\CodeLog\.env ubuntu@${IP}:~/CodeLog/

================================================================================
ğŸ” EC2 ì ‘ì†
================================================================================

# SSH ì ‘ì† (ì¼ë°˜)
ssh -i C:\keys\codelog-keypair.pem ubuntu@YOUR_EC2_IP

# SSH ì ‘ì† (PowerShell ë³€ìˆ˜ ì‚¬ìš©)
ssh -i $KEY ubuntu@$IP

# ëª…ë ¹ ì‹¤í–‰ í›„ ì¦‰ì‹œ ì¢…ë£Œ
ssh -i $KEY ubuntu@$IP "docker compose ps"

# íŒŒì¼ ë‚´ìš© í™•ì¸
ssh -i $KEY ubuntu@$IP "cat ~/CodeLog/.env"

================================================================================
ğŸš€ ë°°í¬ ë° ì¬ì‹œì‘ (EC2 ì„œë²„)
================================================================================

# ê¸°ë³¸ ëª…ë ¹ì–´ë“¤
cd ~/CodeLog                        # í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ì´ë™
git pull origin main                # ìµœì‹  ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
docker compose down                 # ì»¨í…Œì´ë„ˆ ì¤‘ì§€
docker compose up -d --build        # ë¹Œë“œ ë° ì‹œì‘
docker compose ps                   # ìƒíƒœ í™•ì¸
docker compose logs -f              # ë¡œê·¸ ë³´ê¸°

# í•œ ì¤„ ëª…ë ¹ì–´ (ë¹ ë¥¸ ì¬ë°°í¬)
cd ~/CodeLog && git pull origin main && docker compose down && docker compose up -d --build

# ê°œë³„ ì„œë¹„ìŠ¤ ì¬ì‹œì‘
docker compose restart frontend
docker compose restart backend
docker compose restart mysql

# íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ë¹Œë“œ
docker compose up -d --build frontend

================================================================================
ğŸ“Š ë¡œê·¸ í™•ì¸ (EC2 ì„œë²„)
================================================================================

# ì „ì²´ ë¡œê·¸ ì‹¤ì‹œê°„ ë³´ê¸°
docker compose logs -f

# íŠ¹ì • ì„œë¹„ìŠ¤ ë¡œê·¸
docker compose logs -f frontend
docker compose logs -f backend
docker compose logs -f mysql

# ìµœê·¼ 100ì¤„ë§Œ
docker compose logs --tail=100 backend

# ìµœê·¼ 1ì‹œê°„ ë¡œê·¸
docker compose logs --since 1h backend

# ì—ëŸ¬ë§Œ í•„í„°ë§
docker compose logs frontend | grep -i error

# ë¡œê·¸ íŒŒì¼ë¡œ ì €ì¥
docker compose logs > logs.txt

================================================================================
ğŸ” ìƒíƒœ í™•ì¸ (EC2 ì„œë²„)
================================================================================

# Docker ì»¨í…Œì´ë„ˆ ìƒíƒœ
docker compose ps
docker ps -a

# ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ì‹¤ì‹œê°„
docker stats

# ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰
df -h

# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
free -h

# CPU ì‚¬ìš©ëŸ‰
top
htop  # ë” ë³´ê¸° ì¢‹ìŒ

# í¬íŠ¸ í™•ì¸
sudo netstat -tulpn | grep :80
sudo netstat -tulpn | grep :5000
sudo netstat -tulpn | grep :3306

================================================================================
ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ (EC2 ì„œë²„)
================================================================================

# MySQL ì»¨í…Œì´ë„ˆ ì ‘ì†
docker exec -it codelog-mysql bash

# MySQL í´ë¼ì´ì–¸íŠ¸ ì ‘ì†
docker exec -it codelog-mysql mysql -u codelog -p

# ë°ì´í„°ë² ì´ìŠ¤ ì„ íƒ
USE codelog;

# í…Œì´ë¸” ëª©ë¡
SHOW TABLES;

# í…Œì´ë¸” êµ¬ì¡°
DESCRIBE users;

# ë°ì´í„° ì¡°íšŒ
SELECT * FROM projects;
SELECT * FROM users LIMIT 10;

# ë°±ì—…
docker exec codelog-mysql mysqldump -u codelog -p codelog > backup_$(date +%Y%m%d).sql

# ë³µì›
docker exec -i codelog-mysql mysql -u codelog -p codelog < backup.sql

# ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
mysql -u codelog -p codelog < database/migrations/002_add_user_profile.sql

================================================================================
ğŸ§¹ ì •ë¦¬ ë° ìœ ì§€ë³´ìˆ˜ (EC2 ì„œë²„)
================================================================================

# Docker ì •ë¦¬
docker system prune -f              # ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ ì‚­ì œ
docker system prune -a --volumes    # ëª¨ë“  ê²ƒ ì‚­ì œ (ì£¼ì˜!)
docker image prune -a               # ì´ë¯¸ì§€ë§Œ ì‚­ì œ
docker volume prune                 # ë³¼ë¥¨ë§Œ ì‚­ì œ

# ë¡œê·¸ ì •ë¦¬
sudo journalctl --vacuum-time=7d    # 7ì¼ ì´ìƒ ë¡œê·¸ ì‚­ì œ
sudo journalctl --vacuum-size=500M  # 500MB ë„˜ëŠ” ë¡œê·¸ ì‚­ì œ

# ì„ì‹œ íŒŒì¼ ì •ë¦¬
rm -rf ~/CodeLog/frontend/node_modules/.cache
rm -rf ~/CodeLog/backend/node_modules/.cache

# ì˜¤ë˜ëœ ë¹Œë“œ ì‚­ì œ
find ~/CodeLog/android-builds -mtime +30 -delete

================================================================================
ğŸ”§ ë¬¸ì œ í•´ê²° (EC2 ì„œë²„)
================================================================================

# ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker compose restart

# ì™„ì „íˆ ì¬ì‹œì‘ (ì´ˆê¸°í™”)
docker compose down -v
docker compose up -d --build

# íŠ¹ì • ì»¨í…Œì´ë„ˆ ë¡œê·¸ ìƒì„¸
docker logs codelog-backend --tail=200

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì ‘ì†
docker exec -it codelog-backend sh
docker exec -it codelog-frontend sh

# íŒŒì¼ ê¶Œí•œ ìˆ˜ì •
sudo chown -R ubuntu:ubuntu ~/CodeLog
chmod +x ~/backup.sh

# ë°©í™”ë²½ í™•ì¸
sudo ufw status

# í”„ë¡œì„¸ìŠ¤ í™•ì¸
ps aux | grep node
ps aux | grep docker

# í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
sudo kill -9 PID

================================================================================
ğŸ’¾ ë°±ì—… (EC2 ì„œë²„)
================================================================================

# í”„ë¡œì íŠ¸ ì „ì²´ ë°±ì—…
tar -czf ~/CodeLog-backup-$(date +%Y%m%d).tar.gz ~/CodeLog

# ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
docker exec codelog-mysql mysqldump -u codelog -p codelog > ~/backup-$(date +%Y%m%d).sql

# ì—…ë¡œë“œ íŒŒì¼ ë°±ì—…
tar -czf ~/uploads-backup-$(date +%Y%m%d).tar.gz ~/CodeLog/backend/uploads

# ë°±ì—… ë‹¤ìš´ë¡œë“œ (ë¡œì»¬ì—ì„œ)
scp -i $KEY ubuntu@${IP}:~/CodeLog-backup-*.tar.gz D:\Backups\

# ë°±ì—… ë³µì›
tar -xzf CodeLog-backup-20251013.tar.gz

================================================================================
ğŸ”„ ì—…ë°ì´íŠ¸ (EC2 ì„œë²„)
================================================================================

# ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
sudo apt update
sudo apt upgrade -y

# Docker ì—…ë°ì´íŠ¸
sudo apt install docker-ce docker-ce-cli containerd.io

# Node.js ì—…ë°ì´íŠ¸ (í•„ìš”ì‹œ)
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# npm ì „ì—­ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
sudo npm update -g

================================================================================
ğŸŒ ë„ë©”ì¸ ë° SSL (EC2 ì„œë²„)
================================================================================

# SSL ì¸ì¦ì„œ ê°±ì‹ 
sudo certbot renew

# SSL ì¸ì¦ì„œ ìƒíƒœ í™•ì¸
sudo certbot certificates

# Nginx ì„¤ì • í…ŒìŠ¤íŠ¸
docker exec codelog-frontend nginx -t

# Nginx ì¬ì‹œì‘
docker compose restart frontend

================================================================================
ğŸ“ˆ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸
================================================================================

# ì‹¤ì‹œê°„ ìƒíƒœ ì²´í¬ (EC2)
watch -n 5 'docker compose ps && df -h && free -h'

# ë¡œê·¸ ëª¨ë‹ˆí„°ë§
tail -f ~/backup.log

# ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
watch -n 60 df -h

================================================================================
ğŸ¯ ìì£¼ ì‚¬ìš©í•˜ëŠ” ì›Œí¬í”Œë¡œìš°
================================================================================

1ï¸âƒ£ ì½”ë“œ ìˆ˜ì • í›„ ì¬ë°°í¬ (Git)
----------------------------
# ë¡œì»¬
cd D:\CodeLog
git add .
git commit -m "Fix: ìˆ˜ì •ì‚¬í•­"
git push origin main

# ì„œë²„
ssh -i $KEY ubuntu@$IP
cd ~/CodeLog && git pull && docker compose down && docker compose up -d --build


2ï¸âƒ£ ê¸´ê¸‰ íŒ¨ì¹˜ (SCP)
----------------------------
# ë¡œì»¬
scp -i $KEY D:\CodeLog\backend\server.js ubuntu@${IP}:~/CodeLog/backend/

# ì„œë²„
ssh -i $KEY ubuntu@$IP
cd ~/CodeLog && docker compose restart backend


3ï¸âƒ£ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
----------------------------
# ë¡œì»¬ì—ì„œ íŒŒì¼ ì „ì†¡
scp -i $KEY D:\CodeLog\database\migrations\*.sql ubuntu@${IP}:~/CodeLog/database/migrations/

# ì„œë²„ì—ì„œ ì‹¤í–‰
ssh -i $KEY ubuntu@$IP
cd ~/CodeLog
mysql -u codelog -p codelog < database/migrations/002_add_user_profile.sql


4ï¸âƒ£ ì™„ì „ ì¬ì‹œì‘ (ë¬¸ì œ í•´ê²°)
----------------------------
docker compose down -v
docker system prune -f
docker compose up -d --build
docker compose logs -f


5ï¸âƒ£ ë°±ì—… í›„ ì—…ë°ì´íŠ¸
----------------------------
# ë°±ì—…
tar -czf ~/backup-$(date +%Y%m%d).tar.gz ~/CodeLog
docker exec codelog-mysql mysqldump -u codelog -p codelog > ~/db-$(date +%Y%m%d).sql

# ì—…ë°ì´íŠ¸
cd ~/CodeLog && git pull && docker compose down && docker compose up -d --build

================================================================================
ğŸ“ ê¸´ê¸‰ ìƒí™© ëª…ë ¹ì–´
================================================================================

# ì„œë¹„ìŠ¤ ë‹¤ìš´
docker compose down

# ëª¨ë“  ì»¨í…Œì´ë„ˆ ê°•ì œ ì¢…ë£Œ
docker kill $(docker ps -q)

# ë¡¤ë°± (ì´ì „ ì»¤ë°‹ìœ¼ë¡œ)
git log --oneline
git checkout COMMIT_HASH
docker compose down && docker compose up -d --build

# ë°±ì—…ì—ì„œ ë³µì›
tar -xzf ~/backup-20251013.tar.gz
mysql -u codelog -p codelog < ~/db-20251013.sql

================================================================================
ğŸ’¡ íŒ ë° íŠ¸ë¦­
================================================================================

1. PowerShell í”„ë¡œí•„ì— ë³„ì¹­ ì¶”ê°€:
   notepad $PROFILE

   # ì¶”ê°€:
   $KEY = "C:\keys\codelog-keypair.pem"
   $IP = "13.125.XXX.XXX"
   function codelog-ssh { ssh -i $KEY ubuntu@$IP }

2. EC2ì—ì„œ .bashrcì— ë³„ì¹­ ì¶”ê°€:
   nano ~/.bashrc

   # ì¶”ê°€:
   alias cl='cd ~/CodeLog'
   alias dps='docker compose ps'
   alias dlogs='docker compose logs -f'
   alias drestart='docker compose down && docker compose up -d --build'

3. Git ìë™ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸:
   nano ~/deploy.sh

   #!/bin/bash
   cd ~/CodeLog
   git pull origin main
   docker compose down
   docker compose up -d --build

   chmod +x ~/deploy.sh
   ~/deploy.sh

================================================================================
ğŸ“š ì¶”ê°€ ì°¸ê³  ìë£Œ
================================================================================

Docker Compose:     https://docs.docker.com/compose/
Nginx:              https://nginx.org/en/docs/
MySQL:              https://dev.mysql.com/doc/
Git:                https://git-scm.com/doc

================================================================================
ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-10-13
ë²„ì „: 1.2
================================================================================

ì €ì¥ íŒ: ì´ íŒŒì¼ì„ ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€í•˜ì—¬ ë¹ ë¥´ê²Œ ì°¸ì¡°í•˜ì„¸ìš”!
